<!DOCTYPE html>
<html>
  <head>
    <title>Smart Trash Authentication</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <style>
      .centered-form {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
    </style>
    <script>
      function requestQrCode(qrcodeId) {
        fetch(`/qrcode/reqauth/${qrcodeId}`, { method: "POST" })
          .then((response) => {
            const status = document.getElementById("status").innerHTML;
            if (status === "Approved") {
              alert("QR Code Status Already Approved");
            } else {
              alert("Authentication Code Sent!");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>
  </head>
  <body>
    <div class="centered-form">
      <div class="container">
        <h1>QR Code Authentication</h1>
        <% if (error) { %>
        <h5>Id : <span class="text-danger"><%= error %></span></h5>
        <% } else { %>
        <h5>Id : <span class="text-primary"><%= result.qrcodeId %></span></h5>
        <h6>
          Status : <% if (result.status === "pending") { %>
          <span id="status" class="text-warning">Pending</span>
          <% } else if (result.status === "approved"){ %>
          <span id="status" class="text-success">Approved</span>
          <% } %>
        </h6>
        <h6>User ID : <b><%= result.userId %></b></h6>
        <h6>Username : <b><%= result.username %></b></h6>
        <h6>Estimated Points : <b><%= result.est_points %></b></h6>
        <h6>Total Trash : <b><%= result.total_trash %></b></h6>
        <% if (message) { %>
        <h4 class="text-success"><%= message %></h4>
        <% } %> <% } %> <% if (!error) { %> <% if (result.status === "pending")
        { %>
        <form action="/qrcode/approve/<%= result.qrcodeId %>" method="POST">
          <div class="form-group">
            <label for="number">Enter Authentication Code:</label>
            <input
              type="text"
              class="form-control"
              name="code"
              id="code"
              maxlength="4"
            />
          </div>
          <button type="submit" class="btn btn-primary">Authenticate</button>
        </form>
        <button
          type="button"
          class="btn btn-warning"
          onclick="requestQrCode('<%= result.qrcodeId %>')"
        >
          Request Code
        </button>
        <%}else if (result.status === "approved") { %> <% } %> <% } %>
      </div>
    </div>
  </body>
</html>
